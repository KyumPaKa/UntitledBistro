<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bit.UntitledBistro.model.insa.InsaDAO">
	<select id="EmpRegisterList" parameterType="map"
		resultType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
		select EmpRegister_name ,EmpRegister_empnum,
		EmpRegister_age,EmpRegister_tel,EmpRegister_jumin ,EmpRegister_jumin2
		,EmpRegister_grade , EmpRegister_entryDay ,EmpRegister_leavecompany
		from EmpRegister

	</select>


<!-- 	<select id="EmpRegisterRead" parameterType="String"
		resultType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
		select * from EmpRegister where empregister_empnum = #{empregister_empnum}
	</select> -->
	
	<select id="EmpRegisterRead" parameterType="String" resultType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
 		select * from EmpRegister where empregister_empnum = #{empregister_empnum}
 	</select> 
	

	<insert id="EmpRegisterInsert"
		parameterType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
		insert into EmpRegister(empregister_name,empregister_photo, empregister_jumin,
		empregister_jumin2, empregister_empnum, empregister_gender,
		empregister_tel, empregister_age, empregister_addr,empregister_addr2,empregister_addr3,empregister_addr4, empregister_grade,
		empregister_bankname,
		empregister_accountholder, empregister_banknum, empregister_payclassfiy, empregister_entryday,
		empregister_leavecompany,
		empregister_pay,empregister_workplan) Values(#{empregister_name},#{empregister_photo}, #{empregister_jumin},
		#{empregister_jumin2},
		#{empregister_empnum}, #{empregister_gender}, #{empregister_tel}, #{empregister_age},
		#{empregister_addr},#{empregister_addr2},#{empregister_addr3},#{empregister_addr4}, #{empregister_grade}, #{empregister_bankname},
		#{empregister_accountholder}, #{empregister_banknum},
		#{empregister_payclassfiy}, sysdate, #{empregister_leavecompany},
		#{empregister_pay},
		#{empregister_workplan} )

	</insert>

	<select id="getEmpCount" resultType="Integer">
		select count(*) from EmpRegister
	</select>





	<update id="EmpRegisterUpdate" parameterType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
     update EmpRegister set empregister_tel=#{empregister_tel},empregister_age=#{empregister_age}, empregister_addr=#{empregister_addr},empregister_addr2=#{empregister_addr2},empregister_addr3=#{empregister_addr3},empregister_addr4=#{empregister_addr4},empregister_grade=#{empregister_grade},empregister_bankname=#{empregister_bankname}, 
     empregister_accountholder=#{empregister_accountholder},empregister_banknum=#{empregister_banknum},empregister_payclassfiy=#{empregister_payclassfiy},empregister_leavecompany=#{empregister_leavecompany},
     empregister_pay=#{empregister_pay}, empregister_workplan=#{empregister_workplan}
     where empregister_empnum = #{empregister_empnum}
 </update>
 
 
 
 <insert id ="calendarEventAdd" parameterType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
	insert into Schedule(summary, schedule_workingstarttime ,  schedule_workingstartday , schedule_workingendtime , schedule_workingendday)
	Values (#{summary },#{schedule_workingstarttime},#{ schedule_workingstartday},#{schedule_workingendtime},#{schedule_workingendday} )
</insert>


<!-- 로그인 -->
<select id = "InsaLoginCheck" resultType="String">
select empregister_name as empregister_name 
,empregister_photo as empregister_photo
from EmpRegister
where empregister_empnum = #{empregister_empnum} and empregister_jumin = #{empregister_jumin}
</select>

<select id="viewMember" resultType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
select 
empregister_name as empregister_name, 
empregister_empnum as empregister_empnum,
empregister_photo as empregister_photo
from EmpRegister 
where empregister_empnum = #{empregister_empnum} and empregister_jumin = #{empregister_jumin}

</select> 

<!-- 출퇴관리 --> 
<!-- <select id = "WorkManagement" resultType="String">
select empregister_name as empregister_name 
from EmpRegister
where empregister_empnum = #{empregister_empnum} and empregister_jumin = #{empregister_jumin}
</select>
 -->

<!-- <select id ="WorkCheck" parameterType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO" resultType="com.bit.UntitledBistro.model.insa.Insa_ScheduleDTO">
SELECT (SELECT COUNT(*) FROM EMPREGISTER WHERE EMPREGISTER_EMPNUM = #{empregister_empnum} AND EMPREGISTER_JUMIN = #{empregister_jumin}) AS SCHEDULE_NO, 
NVL(SCHEDULE_WORKINGSTART, '1111/11/11') AS SCHEDULE_WORKINGSTART, NVL(SCHEDULE_WORKINGEND, '1111/11/11') AS SCHEDULE_WORKINGEND
FROM EMPREGISTER E LEFT OUTER JOIN SCHEDULE S
ON E.EMPREGISTER_EMPNUM = S.SCHEDULE_EMPREGISTER_EMPNUM WHERE EMPREGISTER_EMPNUM = #{empregister_empnum} AND EMPREGISTER_JUMIN = #{empregister_jumin}
</select> -->


<select id ="WorkCheck" resultType="Integer">
select count(*) from EmpRegister where empregister_empnum = #{empregister_empnum} and empregister_jumin = #{empregister_jumin}
</select>


<insert id ="WorkAdd" parameterType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
INSERT INTO SCHEDULE
(SCHEDULE_NO, SCHEDULE_EMPREGISTER_EMPNUM, SCHEDULE_WORKINGSTART)
VALUES ( (SELECT NVL(MAX(SCHEDULE_NO)+1,0)  FROM SCHEDULE), #{empregister_empnum}, SYSDATE)
</insert>

<update id ="WorkEnd" parameterType="com.bit.UntitledBistro.model.insa.Insa_EmpRegisterDTO">
UPDATE Schedule SET SCHEDULE_WORKINGEND = SYSDATE WHERE SCHEDULE_EMPREGISTER_EMPNUM = #{empregister_empnum}
AND to_char( Schedule_WorkingStart, 'yyyymmdd' ) = to_char( sysdate, 'yyyymmdd')

</update>


<select id ="WorkLoginCheck" resultType="String">
select empregister_name as empregister_name 
,empregister_photo as empregister_photo
from EmpRegister
where empregister_empnum = #{empregister_empnum} and empregister_jumin = #{empregister_jumin}
</select>


<select id = "DayCheck" resultType="Integer">
select count(*) from schedule 

where to_char( Schedule_WorkingStart, 'yyyymmdd' ) = to_char( sysdate, 'yyyymmdd') and schedule_empregister_empnum= #{empregister_empnum}



</select>

</mapper>