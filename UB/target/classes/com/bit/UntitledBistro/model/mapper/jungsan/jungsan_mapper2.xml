<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.bit.UntitledBistro.model.jungsan.Jungsan_Input_DAO">
	<select id="getjungsan_inputList" resultType="com.bit.UntitledBistro.model.jungsan.Jungsan_Input_DTO">
		select * from Jungsan_Input
	</select>
	
	<select id="to_date" resultType="string">
		select DISTINCT to_char(sysdate, 'day') from Jungsan_Input
	</select>
	
	<select id="MonthList" resultType="com.bit.UntitledBistro.model.jungsan.Jungsan_Input_DTO">
		select * from Month_Input where month_date like to_date(sysdate , 'YYYY-MM-DD')
	</select>
	
	<insert id="insert_daily">
		insert into Jungsan_Input(
		jungsan_input_cash,jungsan_input_card,
		jungsan_input_grade,jungsan_input_worktime,
		jungsan_input_expenditure,jungsan_input_point,
		jungsan_input_refund,jungsan_input_reason,jungsan_input_date) 
		VALUES(
		#{jungsan_input_cash, jdbcType=NUMERIC},#{jungsan_input_card, jdbcType=NUMERIC},
		#{jungsan_input_grade, jdbcType=VARCHAR},#{jungsan_input_worktime, jdbcType=NUMERIC},
		#{jungsan_input_expenditure, jdbcType=NUMERIC},#{jungsan_input_point, jdbcType=NUMERIC},
		#{jungsan_input_refund, jdbcType=NUMERIC},#{jungsan_input_reason, jdbcType=VARCHAR},sysdate)
	</insert>
	
	<update id="update_Monthly">
	update Month_input set
	Month_cash=(select nvl(sum(jungsan_input_cash),0) from jungsan_input where jungsan_input_date between 
	(select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from Month_input) and
	(select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from Month_input)),
	Month_card=(select nvl(sum(jungsan_input_card),0) from jungsan_input where jungsan_input_date between 
	(select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from Month_input) and
	(select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from Month_input)), 
	Month_worktime=(select nvl(sum(jungsan_input_card),0)from jungsan_input where jungsan_input_date like to_date('2020-10-20','YYYY-MM-DD')),
	Month_expenditure=(select nvl(sum(order_pr_ea*order_qt),0)from ORDER_INPUT inner join ORDERLIST on ordin_num = order_ordin_num
	where ordin_end ='취소' and ORDIN_DATE between (select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from dual) and 
	(select DISTINCT to_char(last_day(to_date(sysdate)),'YYYY/MM/DD')from dual)),
	Month_point=(select nvl(sum(jungsan_input_point),0) from jungsan_input where jungsan_input_date between 
	(select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from Month_input) and
	(select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from Month_input)),
	Month_refund=(select nvl(sum(jungsan_input_refund),0) from jungsan_input where jungsan_input_date between 
	(select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from Month_input) and
	(select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from Month_input)) ,
	Month_sum=(select nvl(sum(jungsan_input_cash+jungsan_input_card+jungsan_input_point),0) from jungsan_input where jungsan_input_date between 
	(select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from Month_input) and
	(select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from Month_input)),
	Month_real_sum=(select nvl(sum(jungsan_input_cash+jungsan_input_card+jungsan_input_point-1000),0) 
	from jungsan_input where jungsan_input_date between 
	(select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from Month_input) and
	(select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from Month_input)),
	Month_date= sysdate where Month_date between 
   (select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from payment) and 
   (select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from payment)
	</update>
	
	<select id="Benchmark" resultType="int">
		select nvl(sum(Jungsan_Input_cash+Jungsan_Input_card-Jungsan_Input_point),0) from Jungsan_Input where 
		jungsan_input_date between
		(select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from Jungsan_Input) and 
		(select DISTINCT to_char(last_day(to_date(sysdate)),'YYYY/MM/DD')from Jungsan_Input)
	</select>
	
	
	<insert id="insert_Initial_value">
		insert into Month_input values(0,0,0,0,0,0,0,0,sysdate)
	</insert>
	
	<update id="update" parameterType="com.bit.UntitledBistro.model.jungsan.Jungsan_Input_DTO">
	update Jungsan_Input set 
        jungsan_input_cash= #{jungsan_input_cash, jdbcType=NUMERIC},
        jungsan_input_card= #{jungsan_input_card, jdbcType=NUMERIC},
		jungsan_input_grade= #{jungsan_input_grade, jdbcType=VARCHAR},
		jungsan_input_worktime= #{jungsan_input_worktime, jdbcType=NUMERIC},
		jungsan_input_expenditure= #{jungsan_input_expenditure, jdbcType=NUMERIC},
		jungsan_input_point= #{jungsan_input_point, jdbcType=NUMERIC},
		jungsan_input_refund= #{jungsan_input_refund, jdbcType=NUMERIC},
		jungsan_input_reason= #{jungsan_input_reason, jdbcType=VARCHAR} 
     where 
        jungsan_input_date like to_date (sysdate,'YYYY-MM-DD')
	</update>
	
	<select id="count_difference" resultType="int">
	select count(difference) from jungsan_difference where difference_date like to_date(sysdate,'YYYY-MM-DD')
	</select>
	
	<select id="to_difference" resultType="int">
	select sum(difference) from jungsan_difference where difference_date like to_date(sysdate,'YYYY-MM-DD')
	</select>
	
	<insert id="insert_difference">
		insert into jungsan_difference values(0,0,sysdate)
	</insert>
	
	<update id="update_difference" parameterType="com.bit.UntitledBistro.model.jungsan.Jungsan_Input_DTO">
	update jungsan_difference set 
     difference=(select sum(((select nvl(sum(payment_cash+payment_card+payment_point),0) 
	 from payment where payment_state='성공' and payment_date like to_date(sysdate,'YYYY-MM-DD'))-
     (select nvl(sum(JUNGSAN_INPUT_CASH+JUNGSAN_INPUT_CARD +JUNGSAN_INPUT_POINT -JUNGSAN_INPUT_REFUND),0)
     from jungsan_input where JUNGSAN_INPUT_DATE like to_date(sysdate,'YYYY-MM-DD'))))from dual) 
     where difference_date like to_date(sysdate,'YYYY-MM-DD')
	</update>
	
	<update id="update_difference_Month" parameterType="com.bit.UntitledBistro.model.jungsan.Jungsan_Input_DTO">
	update jungsan_difference set difference_Month = (select nvl(sum(difference),0) from jungsan_difference where 
     difference_date between (select DISTINCT to_char(TRUNC(to_date(sysdate),'MM'))from payment) and 
    (select DISTINCT to_char(last_day(to_date(sysdate))+1,'YYYY/MM/DD')from payment))
	</update>
	
	<select id="differenceList" resultType="com.bit.UntitledBistro.model.jungsan.Jungsan_Input_DTO">
		select * from jungsan_difference
	</select>
	
</mapper> 