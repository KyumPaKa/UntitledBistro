<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="jaego">
 	<select id="itemSelectAll" parameterType="item" resultType="item">
		SELECT 
			 ITEM_PRODUCT_CODE								
			,PRODUCT_NAME									
			,SUM(ITEM_QTY)								AS ITEM_QTY
		FROM 
			(
			SELECT 
		    	 /*+ INDEX_DESC(ITEM PK_ITEM_NO) */ 
		    	 I.ITEM_PRODUCT_CODE					AS ITEM_PRODUCT_CODE
		    	,I.ITEM_QTY								AS ITEM_QTY
		    	,I.ITEM_REGDATE							AS ITEM_REGDATE
		    	,P.PRODUCT_NAME           				AS PRODUCT_NAME
		    FROM 
		    	ITEM I
		    INNER JOIN
		        PRODUCT P
		    ON
		    	I.ITEM_PRODUCT_CODE = P.PRODUCT_CODE 
		    <where>
		    <if test="product_name != '' and product_name != null">
		    <![CDATA[
		    	PRODUCT_NAME = #{product_name}
		    ]]>
		    </if>
		    <if test="startDate != '' and startDate != null">
		    <![CDATA[
		    	AND ITEM_REGDATE <= TO_DATE(#{startDate},'YYYY/MM/DD')
		    ]]>
		    </if>
		    </where> 
		    )           
		GROUP BY
			 ITEM_PRODUCT_CODE
        	,PRODUCT_NAME 
 	</select>
 	
 	<insert id="itemInsert">
		INSERT INTO ITEM 
		VALUES(#{item_no}, #{item_product_code}, #{item_qty})
 	</insert>
 	
 	<update id="itemUpdate" parameterType="item">
		UPDATE ITEM 
		SET ITEM_PRODUCT_CODE=#{item_product_code}, ITEM_QTY=#{item_qty}
		WHERE ITEM_NO=#{item_no}
 	</update>
 	
 	<delete id="itemDelete" parameterType="item">
 		DELETE ITEM
 		WHERE ITEM_NO=#{item_no}
 	</delete>
</mapper>